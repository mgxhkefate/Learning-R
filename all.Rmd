---
title: "all"
author: "mgxhkefate"
date: "2025-12-04"
output: html_document
---

```{R globel setting of code chunks, include = FALSE}
# the global setting of code chunks
knitr::opts_chunk$set(echo=FALSE, message=FALSE, warning=FALSE)
```

This document is used for recording the process of learning R which may include different parts about different analysis methods.

## Structural Equation Model, SEM

> Complete SEM code is in `src/SEM.R`.

SEM is used to explore the relationship between the latent variables which reflect more than two observed variables.

The data used to learn SEM is generated by `src/py/data_sem.py`.

```{r loading data}
data <- read.csv("./data/raw/sem_synthetic/sem_synthetic.csv")
```

`Laveen` is usually used to do SEM analysis.

```{r loading R package}
# install.packages("lavaan")
library(lavaan)
```

### 1. Define the SEM model

First step, we should define the latent variables using `A =~ a1 + a2 +a3`.

```{r config latent variables}
model <- ' 
  Extraversion =~ ext_it1 + ext_it2 + ext_it3 + ext_it4
  Neuroticism =~ neu_it1 + neu_it2 + neu_it3 + neu_it4
  Conscientiousness =~ con_it1 + con_it2 + con_it3 + con_it4
'
```

Then, fit model and use `summary` to print all the results.

```{r fit model}
fit <- sem(model, data)
summary(fit)
```

Second, we can define the relationship between the latent variables using `A ~ B` representing the regression from B to A, like B$\rightarrow$A.

```{r the path model}
model <- ' 
  Extraversion =~ ext_it1 + ext_it2 + ext_it3 + ext_it4
  Neuroticism =~ neu_it1 + neu_it2 + neu_it3 + neu_it4
  Conscientiousness =~ con_it1 + con_it2 + con_it3 + con_it4
  
  Extraversion ~ Neuroticism
'
fit <- sem(model, data)
summary(fit)
```

Third, sometimes we should assign the correlation of two variables between latent variables or observed variables. So `A ~~ B` is used to define the correlation between two variables.

```{r the correlation}
model <- ' 
  Extraversion =~ ext_it1 + ext_it2 + ext_it3 + ext_it4
  Neuroticism =~ neu_it1 + neu_it2 + neu_it3 + neu_it4
  Conscientiousness =~ con_it1 + con_it2 + con_it3 + con_it4
  
  Extraversion ~ Neuroticism
  Extraversion ~~ Conscientiousness 
'
fit <- sem(model, data)
summary(fit)
```

There is something should be noticed that the `lavaan` automatically build the correlation between exogenous latent variables. So it's common to see additional correlations in the summary.

### 2. Draw plots

We usually use `semPlot` to draw the graph of SEM.

```{r loading}
# install.packages("semPlot")
library(semPlot)
semPaths(fit, "std", layout="tree", edge.label.cex = 1.2)
```

### 3. Model fit indices

After fit SEM model, we need to figure out whether the model fit data well. In this procedure, some indices are used to measure the goodness-of-fit.

```{r}
model_indices <- fitmeasures(fit, fit.measures = "all")
model_indices
```

Something should be noticed is that the object of `fitmeasures()` should be the fit results of model.

### 4. Model modified indices

In most cases, our models are not the perfect one, so we should adjust our model and do re-analysis depending the model modified indices.

```{r}
modindices(fit)
```
